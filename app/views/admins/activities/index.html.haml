- content_for(:page, 'activities')
- content_for(:title, 'Constipated koala | activiteiten') 

%section#content
  = render 'layouts/search'

  .page.page-form{ :data => { 'authenticity_token' => form_authenticity_token}}
    .row
      .col-md-6.hidden-xs
        .panel.panel-default
          .panel-heading
            %i.fa.fa-fw.fa-ticket
            Niet betaalde activiteiten
            
          .panel-body#participants
            - @detailed.each do |activity|
              %table.table.table-striped.table-linked{ :data => { 'id' => activity.id } }
                %thead
                  %tr{ :style => 'font-size: 1.1em;' } 
                    %td{ :colspan => 3 }= link_to "#{activity.name}", activity, :style => 'left: -10px; position: relative;'
                    
                %tbody
                  - activity.participants.joins(:member).order('members.first_name', 'members.last_name').where(:paid => false).each do |participant|
                    - if !participant.currency.nil?
                      %tr{ :class => ('red' unless participant.currency.nil? || participant.paid), :data => { :id => participant.id, :email => participant.member.email }  }
                        %td= link_to "#{participant.member.name}", participant.member
                
                        - if !participant.currency.nil?
                          %td
                            %span{ :style => 'line-height: 39px;' }= number_to_currency(participant.currency, :unit => '€')
                            
                        %td.buttons
                          .btn-group
                            - if participant.paid
                              %button.btn.btn-primary.unpaid{ :class => ('hidden' if participant.currency.nil? || participant.currency == 0 )}
                                %i.fa.fa-fw.fa-check
                            - else
                              %button.btn.btn-warning.paid{ :class => ('hidden' if participant.currency.nil? || participant.currency == 0 )}
                                %i.fa.fa-fw.fa-times
                            %button.btn.btn-default.destroy
                              %i.fa.fa-fw.fa-trash-o
                      

      = form_for :activity, url: activities_path, method: :post, :class => 'form-validation' do |f|   
        - if @activity.errors.any?
          .col-md-6
            .alert.alert-danger
              %button.close{ type: "button" } ×
              %span Oeps, niet alles is goed ingevuld;
              %ul
              - @activity.errors.full_messages.each do |msg|
                %li= msg
        
        .col-md-6
          .panel.panel-default
            .panel-heading
              %i.fa.fa-fw.fa-ticket
              Nieuwe activiteit
            .panel-body
            
              .form-group
                .row
                  .col-md-8              
                    = label(:activity, :name)
                    = f.text_field :name, :value => @activity.name, :class => 'form-control'
                  .col-md-4
                    = label(:activity, :price)
                    = f.text_field :price, :value => number_to_currency(@activity.price, :unit => ''), :class => 'form-control'
                
              .form-group
                = label(:activity, :description)
                = f.text_area :description, :value => @activity.description, :class => 'form-control', :rows => 10
                
              .form-group
                .row
                  .col-md-6
                    = label(:activity, :start_date)
                    = f.date_field :start_date, :value => @activity.start_date, :class => 'form-control'
                  .col-md-6
                    = label(:activity, :end_date)
                    = f.date_field :end_date, :value => @activity.end_date, :class => 'form-control'
                    
              
              .form-group
                .row
                  .col-md-12
                    = label(:activity, :poster)
                    .input-group
                      %output.form-control
                        - if !@activity.poster_file_name.nil?
                          = @activity.poster.url(:medium)
  
                      .input-group-btn
                        %button.btn.btn-primary.file-input-wrapper
                          %span uploaden
                          = f.file_field :poster, { 'data-ui-file-upload' => '' }    
                        %button.btn.btn-primary.dropdown-toggle{ 'data-toggle' => 'dropdown', :type => 'button', :class => ( 'disabled' if @activity.poster_file_name.nil? ) }
                          %span.caret
                        %ul.dropdown-menu
                          %li
                            %a.remove verwijder  
                      
                    = f.hidden_field :_destroy, :class => 'remove_poster'
                  
              .form-group
                = label(:activity, :comments)
                = f.text_area :comments, :value => @activity.comments, :class => 'form-control'

              %button.btn.btn-success.wait{type: 'submit'} Opslaan
              = link_to 'Annuleren', activities_path, { :class => 'button btn btn-default' }
                
          .panel.panel-default
            .panel-heading
              %i.fa.fa-fw.fa-ticket
              Activiteiten dit jaar
              
            %table.table.table-striped.table-linked
              %tbody
                - @activities.each do |activity|
                  %tr
                    %td= link_to "#{activity.name}", activity
                    %td.hidden-xs= link_to "#{activity.participants.count} deelnemers", activity
                    %td.hidden-xs= link_to "#{I18n.l(activity.start_date, :format => :day_month)}", activity

